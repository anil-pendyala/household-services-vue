<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Household Services</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@3/dist/vue-router.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="admin.js"></script>
    <script src="customer.js"></script>
    <script src="professional.js"></script>
    <script src="admin_customer.js"></script>
    <script src="admin_professional.js"></script>
    <script src="admin_requests.js"></script>
    <script src="admin_stats.js"></script>
    <script src="customer_booking.js"></script>
    <script src="customer_my_bookings.js"></script>
    <script src="professional_requests.js"></script>
    <script src="professional_assignments.js"></script>
    <script src="professional_profile.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: #f8f9fa;
            padding-top: 70px; /* Space for fixed navbar */
        }
        .container {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 500px; /* Increased width */
            width: 100%;
        }
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            z-index: 1000;
        }
        nav .btn {
            margin: 0 8px;
            padding: 6px 12px;
            font-size: 14px;
        }
        .form-control {
            height: 36px; /* Reduced height */
            font-size: 14px;
            padding: 6px;
        }
        .form-label {
            font-size: 14px;
            margin-bottom: 3px; /* Reduced spacing */
        }
        button {
            font-size: 14px;
            padding: 8px;
        }
        .custom-select {
            position: relative;
            display: flex;
            align-items: center;
        }
        .custom-select select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 100%;
            padding-right: 30px; /* Space for arrow */
        }
        .custom-select::after {
            content: "â–¼";
            position: absolute;
            right: 10px;
            pointer-events: none;
            font-size: 12px;
            color: gray;
        }
        nav {
    background-color: #a6c2ce;
    border-bottom: 1px solid #e0e0e0;
    padding: 10px 0; /* Increased padding for taller navbar */
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
  }

  .nav-container {
    display: flex;
    width: 92%;
    max-width: 1300px; /* Increased max-width */
    margin: 0 auto;
    align-items: center;
    justify-content: space-between;
  }

  .brand {
    font-size: 35px; /* Increased font size */
    font-weight: 600;
    color: #062f64; /*3d5a80*/
    text-decoration: none;
    letter-spacing: 0.5px;
    padding: 8px 15px; /* Increased padding */
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .brand:hover {
    background-color: #f0f4f8;
  }

  .nav-links {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px; /* Increased gap */
  }

  .nav-btn {
    padding: 10px 20px; /* Increased padding */
    margin: 0 3px;
    background-color: transparent;
    color: #2a2222;
    border: none;
    border-radius: 4px;
    text-decoration: none;
    font-weight: 500;
    font-size: 18px; /* Increased font size */
    letter-spacing: 0.3px;
    transition: all 0.2s ease;
    position: relative;
    cursor: pointer;
  }

  .nav-btn::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #3d5a80;
    transform: scaleX(0);
    transition: transform 0.2s ease;
  }

  .nav-btn:hover {
    color: #3d5a80;
    background-color: #f8f9fa;
  }

  .nav-btn:hover::after {
    transform: scaleX(0.8);
  }

  /* Active state styling */
  .nav-btn.router-link-active {
    color: #3d5a80;
    font-weight: 500;
    background-color: #f0f4f8;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  .nav-btn.router-link-active::after {
    transform: scaleX(1);
    background-color: #3d5a80;
  }

  /* Logout button styling */
  .logout-btn {
    color: #d62828;
  }

  .logout-btn:hover {
    color: #d62828;
    background-color: #fff5f5;
  }

  .logout-btn::after {
    background-color: #d62828;
  }

  .admin-nav-group {
    display: flex;
    gap: 8px; /* Increased gap */
    flex-wrap: wrap;
  }

  /* For mobile responsiveness */
  @media (max-width: 768px) {
    .nav-container {
      flex-direction: column;
      width: 100%;
    }

    .brand {
      margin-bottom: 15px; /* Increased margin */
    }

    .nav-links {
      flex-direction: column;
      width: 100%;
    }

    .nav-btn {
      width: 100%;
      text-align: center;
      margin: 2px 0; /* Increased margin */
    }

    .admin-nav-group {
      width: 100%;
    }
  }

  /* Update body padding to accommodate larger navbar */
  body {
    padding-top: 90px; /* Increased to match larger navbar height */
  }

    </style>
</head>
<body>
    <div id="app">
        <!-- Fixed Navigation Bar -->
        <!-- Fixed Navigation Bar -->
        <nav>
            <div class="nav-container">
              <!-- Brand element visible to all users -->
              <router-link to="/" class="brand">Ghar Seva</router-link>

              <div class="nav-links">
                <!-- Removed Home button -->

                <!-- Buttons for non-logged-in users -->
                <router-link to="/register-customer" class="nav-btn" v-if="!isLoggedIn">Register as Customer</router-link>
                <router-link to="/register-professional" class="nav-btn" v-if="!isLoggedIn">Register as Professional</router-link>
                <router-link to="/login" class="nav-btn" v-if="!isLoggedIn">Login</router-link>

                <!-- Admin-specific buttons -->
                <div v-if="isLoggedIn && userRole === 'ADMIN'" class="admin-nav-group">
                  <router-link to="/admin-dashboard" class="nav-btn">Manage Services</router-link>
                  <router-link to="/admin/manage-customers" class="nav-btn">Manage Customers</router-link>
                  <router-link to="/admin/manage-professionals" class="nav-btn">Manage Professionals</router-link>
                  <router-link to="/admin/manage-requests" class="nav-btn">Manage Requests</router-link>
                  <router-link to="/admin/stats" class="nav-btn">Statistics</router-link>
                </div>

                <div v-if="isLoggedIn && userRole === 'CUSTOMER'" class="admin-nav-group">
                    <router-link to="/customer/book-a-service" class="nav-btn">Book a Service</router-link>
                    <router-link to="/customer/my-bookings" class="nav-btn">My Bookings</router-link>
                </div>

                <div v-if="isLoggedIn && userRole === 'PROFESSIONAL'" class="admin-nav-group">
                    <router-link to="/professional/requests" class="nav-btn">Requests</router-link>
                    <router-link to="/professional/assignments" class="nav-btn">To Be Attended</router-link>
                    <router-link to="/professional/profile" class="nav-btn">Profile & Stats</router-link>
                </div>

                <!-- Logout button for logged-in users -->
                <button @click="logout" class="nav-btn logout-btn" v-if="isLoggedIn">Logout</button>
              </div>
            </div>
          </nav>



        <router-view></router-view>
    </div>

    <script>
        const Home = { template: '<h2 class="text-center">Welcome to Household Services</h2>' };

        const Login = {
            template: `
                <div class="container">
                    <h2 class="text-center mb-3">Login</h2>
                    <form @submit.prevent="login">
                        <div class="mb-3">
                            <label class="form-label">Email:</label>
                            <input type="email" v-model="email" class="form-control" required autofocus>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password:</label>
                            <input type="password" v-model="password" class="form-control" required>
                        </div>
                        <div v-if="error" class="alert alert-danger mb-3">{{ error }}</div>
                        <button type="submit" class="btn btn-primary w-100" :disabled="isLoading">
                            {{ isLoading ? 'Logging in...' : 'Login' }}
                        </button>
                        <div class="mt-3 text-center">

                        </div>
                    </form>
                </div>
            `,
            data() {
                return {
                    email: "",
                    password: "",
                    error: "",
                    isLoading: false
                };
            },
            methods: {
                login() {
                    this.isLoading = true;
                    this.error = "";

                    axios.post("http://127.0.0.1:5000/login", {
                        email: this.email,
                        password: this.password
                    })
                    .then(response => {
                        // Store user data or token if provided by the backend
                        if (response.data.userId) {
                            localStorage.setItem('userId', response.data.userId);
                        }

                        if (response.data.userRole) {
                            localStorage.setItem('userRole', response.data.userRole);
                        }

                        console.log(response.data);
                    //     const retrievedData = JSON.parse(localStorage.getItem("userRole"));
                    //     console.log(retrievedData);

                        // Redirect based on user type if provided
                        if (response.data.userRole === 'PROFESSIONAL') {
                            this.$router.push('/professional/requests');
                        } if (response.data.userRole === 'CUSTOMER') {
                            this.$router.push('/customer/book-a-service');
                        } if (response.data.userRole === 'ADMIN') {
                            this.$router.push('/admin-dashboard');
                        }
                    })
                    .catch(error => {
                        if (error.response && error.response.data && error.response.data.error) {
                            this.error = error.response.data.error;
                        } else {
                            this.error = "Login failed. Please check your credentials and try again.";
                        }
                    })
                    .finally(() => {
                        this.isLoading = false;
                    });
                }
            }
        };

        const RegisterCustomer = {
            template: `
                <div class="container">
                    <h2 class="text-center mb-3">Customer Registration</h2>
                    <form @submit.prevent="registerCustomer">
                        <div class="mb-2">
                            <label class="form-label">Name:</label>
                            <input type="text" v-model="name" class="form-control" required autofocus>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Email:</label>
                            <input type="email" v-model="email" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Password:</label>
                            <input type="password" v-model="password" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Location:</label>
                            <input type="text" v-model="location" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Pin Code:</label>
                            <input type="text" v-model="pinCode" class="form-control" maxlength="6" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Register</button>
                    </form>
                </div>
            `,
            data() { return { name: "", email: "", password: "", location: "", pinCode: "" }; },
            methods: {
                registerCustomer() {
                    axios.post("http://127.0.0.1:5000/register-customer", {
                        name: this.name, email: this.email, password: this.password, location: this.location, pin_code: this.pinCode
                    }).then(() => this.$router.push('/login'))
                      .catch(error => alert(error.response ? error.response.data.error : "An error occurred"));
                }
            }
        };

        const RegisterProfessional = {
            template: `
                <div class="container">
                    <h2 class="text-center mb-3">Professional Registration</h2>
                    <form @submit.prevent="registerProfessional">
                        <div class="mb-2">
                            <label class="form-label">Name:</label>
                            <input type="text" v-model="name" class="form-control" required autofocus>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Email:</label>
                            <input type="email" v-model="email" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Password:</label>
                            <input type="password" v-model="password" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Service:</label>
                            <select v-model="selectedService" class="form-control" required>
                                <option v-for="service in services" :key="service.id" :value="service.id">{{ service.name }}</option>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Experience (Years):</label>
                            <input type="number" v-model="experience" class="form-control" min="0" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Description:</label>
                            <textarea v-model="description" class="form-control" rows="2" required></textarea>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Profile Doc URL:</label>
                            <input type="text" v-model="profileDocUrl" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Register</button>
                    </form>
                </div>
            `,
            data() { return { name: "", email: "", password: "", selectedService: "", experience: "", description: "", profileDocUrl: "", services: [] }; },
            mounted() {
                axios.get("http://127.0.0.1:5000/services")
                    .then(response => { this.services = response.data; })
                    .catch(error => console.error("Error fetching services:", error));
            },
            methods: {
                registerProfessional() {
                    axios.post("http://127.0.0.1:5000/register-professional", {
                        name: this.name, email: this.email, password: this.password, service_id: this.selectedService, experience: this.experience, description: this.description, profile_doc_url: this.profileDocUrl
                    }).then(() => this.$router.push('/'))
                      .catch(error => alert(error.response ? error.response.data.error : "An error occurred"));
                }
            }
        };

        // Define placeholder dashboard components (you can implement these later)

        const router = new VueRouter({
            routes: [
                { path: '/', component: Home },
                { path: '/login', component: Login },
                { path: '/register-customer', component: RegisterCustomer },
                { path: '/register-professional', component: RegisterProfessional },
                { path: '/customer-dashboard', component: CustomerDashboard },
                { path: '/admin-dashboard', component: AdminDashboard },
                { path: '/admin/manage-customers', component: CustomerManagement },
                { path: '/admin/manage-professionals', component: ProfessionalManagement },
                { path: '/admin/manage-requests', component: RequestManagement },
                { path: '/customer/book-a-service', component: BookService },
                { path: '/customer/my-bookings', component: MyBookings },
                { path: '/professional/requests', component: ProfessionalRequests },
                { path: '/professional/assignments', component: ProfessionalAssignments },
                { path: '/professional/profile', component: ProfessionalProfile },
                { path: '/admin/stats', component: Stats }
            ]
        });

        // Add this before creating the Vue instance
router.beforeEach((to, from, next) => {
    // Check if user is logged in
    const isLoggedIn = !!localStorage.getItem('userId');
    const userRole = localStorage.getItem('userRole') || '';

    // Routes that require authentication
    const authRequiredRoutes = [
        '/customer-dashboard',
        '/admin-dashboard',
        '/admin/manage-customers',
        '/admin/manage-professionals',
        '/admin/manage-requests',
        '/admin/stats',
        '/customer/book-a-service',
        '/customer/my-bookings',
        '/professional/requests',
        '/professional/assignments',
        '/professional/profile'
    ];

    // Role-specific routes
    const adminRoutes = ['/admin-dashboard', '/admin/manage-customers', '/admin/manage-professionals', '/admin/manage-requests', '/admin/stats'];
    const customerRoutes = ['/customer-dashboard', '/customer/book-a-service', '/customer/my-bookings'];
    const professionalRoutes = ['/professional/requests', '/professional/assignments', '/professional/profile'];

    // Check if route requires authentication
    if (authRequiredRoutes.includes(to.path)) {
        if (!isLoggedIn) {
            // Redirect to login if not logged in
            return next('/login');
        }

        // Check role permissions
        if (adminRoutes.includes(to.path) && userRole !== 'ADMIN') {
            return next('/');
        }
        if (customerRoutes.includes(to.path) && userRole !== 'CUSTOMER') {
            return next('/');
        }
        if (professionalRoutes.includes(to.path) && userRole !== 'PROFESSIONAL') {
            return next('/');
        }
    }

    next();
});


new Vue({
    el: "#app",
    router,
    data: {
        isLoggedIn: false,
        userRole: ''
    },
    created() {
        // Set initial auth state
        this.checkAuthState();

        // Set up login state check when router changes
        this.$router.afterEach(() => {
            this.checkAuthState();
        });
    },
    methods: {
        checkAuthState() {
            this.isLoggedIn = !!localStorage.getItem('userId');
            this.userRole = localStorage.getItem('userRole') || '';
        },
        logout() {
            if (window.confirm("Are you sure you want to logout?")) {
                localStorage.removeItem('userId');
                localStorage.removeItem('userRole');
                this.isLoggedIn = false;
                this.userRole = '';
                this.$router.push('/');
            }
        }
    }
});


    </script>
</body>
</html>
